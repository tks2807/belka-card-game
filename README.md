# Belka Card Game Bot

Телеграм-бот для игры в карточную игру "Белка".

## Установка

1. Клонируйте репозиторий
```bash
git clone <repository-url>
cd belka-card-game
```

2. Установите зависимости
```bash
npm install
```

3. Создайте файл .env и добавьте в него токен бота
```
BOT_TOKEN=your_bot_token
```

## База данных PostgreSQL

### Настройка PostgreSQL

1. Установите PostgreSQL на вашу систему (если еще не установлен)
   - Скачайте установщик с [официального сайта](https://www.postgresql.org/download/windows/)
   - Запустите установщик и следуйте инструкциям
   - Запомните пароль для пользователя postgres

2. Создайте базу данных для бота:
   - Запустите pgAdmin из меню Пуск
   - Подключитесь к серверу PostgreSQL (введите пароль пользователя postgres)
   - Щелкните правой кнопкой по разделу "Databases"
   - Выберите "Create" > "Database..."
   - Введите имя "belka_game" и нажмите "Save"

3. Настройте переменные окружения в файле .env:
```
DB_USER=postgres
DB_HOST=127.0.0.1
DB_NAME=belka_game
DB_PASSWORD=ваш_пароль_от_postgres
DB_PORT=5432
```

4. Скомпилируйте проект:
```bash
npx tsc
```

5. Инициализируйте схему базы данных:
```bash
node dist/db/setupDatabase.js
```

### Проблемы с подключением

Если вы получаете ошибку "ECONNREFUSED" при подключении:
1. Убедитесь, что PostgreSQL запущен (проверьте службы Windows)
2. Проверьте, что IP-адрес и порт указаны правильно (127.0.0.1:5432)
3. Убедитесь, что пароль в .env файле верный
4. Проверьте, что база данных "belka_game" создана

## Запуск

```bash
npm start
```

## Команды бота

- /start - Начать работу с ботом
- /help - Показать справку
- /join - Присоединиться к игре
- /startbelka - Начать игру (Белка - до 12 глаз)
- /startwalka - Начать игру (Шалқа - до 6 глаз)
- /state - Показать текущее состояние игры
- /leaderboardall - Показать глобальную таблицу лидеров
- /leaderboardchat - Показать таблицу лидеров для текущего чата
- /endgame - Проголосовать за завершение игры
- /clearbot - Сбросить игру
- /inline_setup - Инструкция по настройке инлайн-режима

## Правила игры

Белка - это казахская карточная игра, где игроки соревнуются в командах:

- Игра для 4-х игроков (2 команды по 2 игрока)
- Цель: набрать 12 глаз (режим "Белка") или 6 глаз (режим "Шалқа")
- Валеты всегда козыри, старшинство: крести > пики > черви > буби
- "Голая" - это когда команда берет все взятки (мгновенная победа)

Полные правила доступны по команде /help.
